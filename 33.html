<!doctype html><html lang=zh-cn><title>将域名加入 HSTS Preload List - imlonghao</title><meta name=description content="大家可以参考我之前写的博文，里面有对 HSTS 的简介"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=renderer content="webkit"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><link rel=dns-prefetch href=//vip1.loli.net><link rel=stylesheet href=/static/hw3x7x.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqusjs.css integrity="sha256-GxdCIOyfxQ1OBfS99qAIJDoGK1ADuBsxhMTqXG82fAY=" crossorigin=anonymous><script src=/static/hw3x7x.js async></script><script src=https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqus.js integrity="sha256-LVaMHPQ2zLqOc5rXSAfr4d1PIkEGNLyyUTDNPZmTtUw=" crossorigin=anonymous></script><script src=//instant.page/3.0.0 type=module defer integrity=sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1></script><link rel=alternate type=application/rss+xml title="imlonghao Feed" href=https://imlonghao.com/feed.xml><div id=container><div id=header><div id=post-nav><a href=./>Home</a>
&nbsp;»&nbsp;
<a href=./33.html>将域名加入 HSTS Preload List</a></div></div><div class=clearfix></div><div id=title>将域名加入 HSTS Preload List</div><div id=content class=markdown-body><p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/gyvQO6kLu8hnVH7.png><h2>什么是 HSTS</h2><p>大家可以参考我之前写的博文，里面有对 HSTS 的简介<p><a href=https://imlonghao.com/3.html rel=nofollow>Chrome 通过 HSTS 强制使用 HTTPS</a><p><a href=https://tools.ietf.org/html/rfc6797 rel=nofollow>RFC 6797</a><h2>一点小小的不足</h2><p>以我的网站为例，我来讲讲不足的地方。<p>假设一个用户从来没有访问过我的网站，并且他第一次访问的时候访问的是 <code>http://imlonghao.com</code> ，在正常的情况下，我的服务器就会给这位用户返回一个 301 跳转到 <code>https://imlonghao.com</code> ，并且带上 HSTS 头<p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/PzLSxWaO6BIvqpU.png><p>在用户下次访问我的博客时，只要 HSTS 还在有效期中，浏览器就会直接响应一个 <code>HTTP 307</code> 头，并跳转到相对应的 <code>https</code> 页面，并且这是不需要经过数据传输的，直接在本地浏览器进行的处理<p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/3ISzZFPt1NYlLeK.png><p>这似乎没什么问题，对吧。<p>但是，当他第一次访问的时候就可能有问题了，由于是 <code>http</code> 协议进行的数据传输，因此这里就可能被别人进行链路挟持了，他就可以改掉你的 HSTS 规则，然后给你直接挟持到他们指定的网站上去，那么用户可能就无法正常访问到我的博客了。<p>于是乎，HSTS Preload List 似乎就是一种机制来解决这个问题<h2>HSTS Preload List</h2><h3>简介</h3><p>(我就直接翻译官方的原话吧)<p>HSTS Preload List 是一个站点的列表，他将会被通过硬编码写入 Chrome 浏览器中，列表中的站点将会默认使用 <code>HTTPS</code> 进行访问，此外，Firefox 、Safari 、IE 11 和 Edge 也同样一份 HSTS 站点列表，其中包括了 Chrome 的列表<h3>申请要求</h3><p>Expiry must be at least eighteen weeks (10886400 seconds).
The includeSubdomains token must be specified.
The preload token must be specified.
If you are serving an additional redirect from your HTTPS site, that redirect must still have the HSTS header (not the page it redirects to).<ul><li>有一张有效的证书（如果是使用了 <code>SHA-1</code> 证书签名算法的必须在 2016 年前失效）<li>重定向所有的 HTTP 流量到 HTTPS （ HTTPS ONLY ）<li>全部子域名的流量均通过 HTTPS ，如果子域名的 <code>www</code> 存在的话也同样需要通过 HTTPS 传输。例如我的子域名是 <code>subdomain.imlonghao.com</code>，并且 <code>www.subdomain.imlonghao.com</code> 也存在，所以 <code>www.subdomain.imlonghao.com</code> 也需要通过 HTTPS 传输<li>在相应的域名中输出 HSTS 响应头<li>过期时间至少大于 18 周（10886400 秒）<li>必须声明 <code>includeSubdomains</code><li>必须声明 <code>preload</code><li>跳转过去的那个页面也需要有 <code>HSTS</code> 头，应该指的是 <code>http://imlonghao.com</code></ul><p>一个例子：<pre><code>Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
</code></pre><h3>开始申请</h3><p>很简单，我们需要打开这个页面，<a href=https://hstspreload.appspot.com/ rel=nofollow>HSTS Preload Submission</a><p>然后输入你的域名按 <code>ENTER</code><p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/gaQkiAHKIZvdF71.png><p>然后就会提示你你的域名已经在等待审核了，预计有几个星期甚至是一个多月才可以审核通过<h3>查看结果</h3><p>如果你的域名已经通过审核的话，页面会是这样的<p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/OLzU3kNIuoAmyh9.png><p>而且这个时候在 chromium 的源代码中是可以找的到你的域名的了<p>参考这个，<a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/http/transport_security_state_static.json&q=neveta.com&sq=package:chromium&type=cs&l=4970" rel=nofollow>https://code.google.com/p/chromium/codesearch#chromium/src/net/http/transport_security_state_static.json</a><h2>一点好玩的想法</h2><p>如果我的域名在这个列表里面，并且大多数浏览器都已经更新到新的列表，那么我就可以去用国内的 VPS 之类的，不打开 80 端口，只打开 443 ，浏览器同样会跳转过来，这样就可以免备案了~<dl><dt>不过似乎这样对搜索引擎不太友好~</dl><p>:)<hr><p>Update in 2016.1.10 23:50<p>本站已经成功加入 HSTS Preload List ，预计几个月之后就可以进 stable 了！<p>并且，十分幸运的是，和一个我挺喜欢的博客 (imququ.com) 并排<p><a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/http/transport_security_state_static.json&q=imlonghao.com&sq=package:chromium&type=cs&l=5201" rel=nofollow>#chromium/src/net/http/transport_security_state_static.json&q=imlonghao.com&sq=package:chromium&type=cs&l=5201</a><p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/RnV14jilCPgm85O.png></div></div><div id=disqus_thread></div><div id=footer><span>Copyright © 2015 - 2020 imlonghao. Theme by
<a href=http://simiki.org/ target=_blank rel="noopener noreferrer">Simiki</a>. CC BY-NC-SA 4.0</span></div><script src=https://cdn.jsdelivr.net/npm/cfga@1.0.3/cfga.min.js integrity="sha256-TXHTTKAPRQ9mgacgN+couk0xnzQ6uOXTZ5ojH1q6GUk=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/vanilla-lazyload@12.3.0/dist/lazyload.min.js integrity="sha256-bojBIKfs4l2WDcJODncBIGEe5fhU7/sM3zRO5/f2nqE=" crossorigin=anonymous async></script>