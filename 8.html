<!doctype html><html lang=zh-cn><title>Linux 服务器被 DDoS / CC 时应急的封 IP 方法 - imlonghao</title><meta name=description content="当我们的 Linux 服务器受到少量攻击时，这时候我们可以使用 iptables 来手动封禁这些攻击者的IP。"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=renderer content="webkit"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><link rel=dns-prefetch href=//vip1.loli.net><link rel=stylesheet href=/static/hw3x7x.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqusjs.css integrity="sha256-GxdCIOyfxQ1OBfS99qAIJDoGK1ADuBsxhMTqXG82fAY=" crossorigin=anonymous><script src=/static/hw3x7x.js async></script><script src=https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqus.js integrity="sha256-LVaMHPQ2zLqOc5rXSAfr4d1PIkEGNLyyUTDNPZmTtUw=" crossorigin=anonymous></script><script src=//instant.page/3.0.0 type=module defer integrity=sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1></script><link rel=alternate type=application/rss+xml title="imlonghao Feed" href=https://imlonghao.com/feed.xml><div id=container><div id=header><div id=post-nav><a href=./>Home</a>
&nbsp;»&nbsp;
<a href=./8.html>Linux 服务器被 DDoS / CC 时应急的封 IP 方法</a></div></div><div class=clearfix></div><div id=title>Linux 服务器被 DDoS / CC 时应急的封 IP 方法</div><div id=content class=markdown-body><p>当我们的 Linux 服务器受到少量攻击时，这时候我们可以使用 iptables 来手动封禁这些攻击者的 IP。<p>如果攻击比较大时，有时我们根本无法响应过来，iptables 基本也就无能为力了，那我们就只能与机房联系让他们想想办法了。<p>对于少量攻击处理的步骤应该是：获取 IP &ndash;> 封 IP<h2>获取攻击者 IP</h2><h3>通过 netstat 获取</h3><p>如果攻击者攻击的是你的 Web 服务的话，默认是 80 端口，我们就可以使用下面的代码！<p>如果攻击的不是 80 端口的话，将下面的两个数字 80 改为你被攻击的端口即可！<p>如果你需要显示多条记录，请自己手动将 <code>head -n20</code> 调大即可<pre><code>netstat -anlp|grep 80|grep tcp|awk '{print $5}'|awk -F: '{print $1}'|sort|uniq -c|sort -nr|head -n20 | netstat -ant |awk '/:80/{split($5,ip,&quot;:&quot;);++A[ip[1]]}END{for(i in A) print A[i],i}' |sort -rn|head -n20
</code></pre><p>###通过 tcpdump 获取<p>在使用之前，请确保您的系统已经安装了 tcpdump 。<p>Debian / Ubuntu 系列快速安装如下<pre><code>apt-get install -y tcpdump
</code></pre><p>安装后，使用下面的代码即可。<p>需要注意的是， <code>-i eth0</code> 指的是你主网卡，如果你是 OpenVZ 的虚拟机的话，就改成您的网卡名 venet0<p>同样你需要设置的是， <code>port 80</code> 设置你被攻击的端口， <code>-c 1000</code> 指 tcpdump 需要统计的记录数，他会在达到这个数之后显示结果。 <code>head -20</code> 设置你要显示的记录条数<pre><code>tcpdump -i eth0 -tnn dst port 80 -c 1000 | awk -F&quot;.&quot; '{print $1&quot;.&quot;$2&quot;.&quot;$3&quot;.&quot;$4}' | sort | uniq -c | sort -nr |head -20
</code></pre><h2>封禁 IP</h2><p>通过上面的步骤，我们已经知道是谁在攻击我们了，现在我们就可以将他们拉入 <code>iptables</code> 禁止他们连接到服务器了。<h3>封禁单个 IP</h3><pre><code>iptables -I INPUT -s 211.1.2.1 -j DROP
</code></pre><h3>封禁一个 IP 段</h3><pre><code>iptables -I INPUT -s 211.1.2.0/16 -j DROP
</code></pre><p>如果需要更多关于 iptables 的教程，由于不在本帖需要讲述的内容当中，请自行 Google 答案。<h2>参考资料</h2><p><a href=http://drops.wooyun.org/tips/2457 rel=nofollow>Linux 被 DDOS&CC 攻击解决实例</a></div></div><div id=disqus_thread></div><div id=footer><span>Copyright © 2015 - 2020 imlonghao. Theme by
<a href=http://simiki.org/ target=_blank rel="noopener noreferrer">Simiki</a>. CC BY-NC-SA 4.0</span></div><script src=https://cdn.jsdelivr.net/npm/cfga@1.0.3/cfga.min.js integrity="sha256-TXHTTKAPRQ9mgacgN+couk0xnzQ6uOXTZ5ojH1q6GUk=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/vanilla-lazyload@12.3.0/dist/lazyload.min.js integrity="sha256-bojBIKfs4l2WDcJODncBIGEe5fhU7/sM3zRO5/f2nqE=" crossorigin=anonymous async></script>