<!doctype html><html lang=zh-cn><title>2015.10.04 本站所做的一点优化 - imlonghao</title><meta name=description content="本篇博文主要讲一下今天我对本站所做的一些优化。"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=renderer content="webkit"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><link rel=dns-prefetch href=//vip1.loli.net><link rel=stylesheet href=/static/hw3x7x.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqusjs.css integrity="sha256-GxdCIOyfxQ1OBfS99qAIJDoGK1ADuBsxhMTqXG82fAY=" crossorigin=anonymous><script src=/static/hw3x7x.js async></script><script src=https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqus.js integrity="sha256-LVaMHPQ2zLqOc5rXSAfr4d1PIkEGNLyyUTDNPZmTtUw=" crossorigin=anonymous></script><script src=//instant.page/3.0.0 type=module defer integrity=sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1></script><link rel=alternate type=application/rss+xml title="imlonghao Feed" href=https://imlonghao.com/feed.xml><div id=container><div id=header><div id=post-nav><a href=./>Home</a>
&nbsp;»&nbsp;
<a href=./23.html>2015.10.04 本站所做的一点优化</a></div></div><div class=clearfix></div><div id=title>2015.10.04 本站所做的一点优化</div><div id=content class=markdown-body><p>本篇博文主要讲一下今天我对本站所做的一些优化。<h2>图片迁往七牛</h2><p>以往，本站的图片一律均是存放在 imgur 平台的，然后通过外链 <code>i.imgur.com</code> 这个地址来解析图片。<p>尽管 imgur 使用了 Fastly 公司的 CDN 平台，但是国内用户并没有被分配到亚洲的节点上，而是被分配到了美国，这就导致了一定程度加载图片比较缓慢。<p>下面是一张超级 PING 的结果，可以看到，只有国外的用户访问会比较快，而国内的基本上都在 200 PING 以上。<p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/gan5ohMkirDGT2y.jpg><p>因此，我一张一张将我的图片从 imgur 保存下载，然后上传到七牛，最后再一篇一篇文章来修改图片的地址。<h2>图片针对部分用户启用 WebP</h2><h3>什么是 WebP</h3><blockquote><p>WebP（发音 weppy），是一种同时提供了有损压缩与无损压缩的图片文件格式 ，派生自视频编码格式 VP8，是由 Google 在购买 On2 Technologies 后发展出来，以 BSD 授权条款发布。 WebP 最初在 2010 年发布，目标是减少文件大小，但达到和 JPEG 格式相同的图片质量，希望能够减少图片文件在网络上的发送时间。 2011 年 11 月 8 日，Google 开始让 WebP 支持无损压缩和透明色的功能，而在 2012 年 8 月 16 日的参考实做 libwebp 0.2.0 中正式支持。根据 Google 较早的测试，WebP 的无损压缩比网络上找到的 PNG 文件少了 45％的文件大小，即使这些 PNG 文件在使用 pngcrush 和 PNGOUT 处理过，WebP 还是可以减少 28％的文件大小。</blockquote><p>内容来自维基百科：<a href=https://zh.wikipedia.org/wiki/WebP rel=nofollow>WebP - 维基百科，自由的百科全书</a><h3>支持 WebP 的浏览器</h3><p>目前，支持 WebP 的浏览器并不多，如图所示<p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/MCRaocuASZdLi7O.jpg><p>像 Firefox 、 IE 、Safari 等浏览器目前均不支持该技术，只有老大哥 Chrome 和 Opera 和 Android 等支持。<p>如何判断浏览器是否支持 WebP 图片<p>要判断一个浏览器是否支持 WebP 技术，我们可以通过判断他 header 中的 Accept 来判断。<pre><code>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
</code></pre><p>如果一个浏览器支持 WebP ，那么他的 <code>Accept</code> 中将会有 <code>image/webp</code> ，反之则没有。<h3>在七牛中将图片转换成 WebP 格式</h3><p>七牛针对图片的处理有一个叫 <code>imageView2</code> 的图片基本处理的玩意，参考：<a href=http://developer.qiniu.com/docs/v6/api/reference/fop/image/imageview2.html rel=nofollow>基本处理（imageView2） | 七牛云存储</a><p>简单来说，就是在每一张图片的后面，加上 <code>?imageMogr2/format/webp</code> ，那么这张图片就会自动转换成 WebP 格式。<p>例子：<pre><code>https://imlonghao.com/1.png (原图片)
https://imlonghao.com/1.png?imageMogr2/format/webp (WebP图片)
</code></pre><h3>启用 WebP</h3><p>正如你现在看到的那样，本博客现在已经对 Chrome 用户等启用了 WebP 的图片。<p>博客程序针对这部份用户，会自动在 img 中的 src 的最后加上 <code>?imageMogr2/format/webp</code> 标识<h2>优化 JS / CSS</h2><p>在这部份优化当中，讲究尽可能减少 http 的请求次数，因此，我们最好能够将 JS / CSS 等文件综合在一起。<p>另外，我们还可以进行代码的压缩，减少代码中不必要的注释以及空格、换行等。<p>另外， 我将 Google 统计的代码从之前的在 <code>&lt;/body></code> 之前转移到了 <code>&lt;/head></code> 之前，解决了之前在页面的最后才去请求加载这些外部 JS 所代码的页面加载慢的问题。<p>同时，由于我闲得蛋疼，加上 Google 统计代码以及 Disqus 的代码很久也不会更新一次，因此我将这些代码本地化了，同时也设置了在每天的 0 点自动去同步代码，这样就减少了对外部资源的请求。现在对外部资源的请求基本上都在页面加载完毕之后了，因此速度也有了很大的提升。<hr><p>优化道路任重而道远，今后也一定会更多的小细节需要去优化的，向 imququ 看起！</div></div><div id=disqus_thread></div><div id=footer><span>Copyright © 2015 - 2020 imlonghao. Theme by
<a href=http://simiki.org/ target=_blank rel="noopener noreferrer">Simiki</a>. CC BY-NC-SA 4.0</span></div><script src=https://cdn.jsdelivr.net/npm/cfga@1.0.3/cfga.min.js integrity="sha256-TXHTTKAPRQ9mgacgN+couk0xnzQ6uOXTZ5ojH1q6GUk=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/vanilla-lazyload@12.3.0/dist/lazyload.min.js integrity="sha256-bojBIKfs4l2WDcJODncBIGEe5fhU7/sM3zRO5/f2nqE=" crossorigin=anonymous async></script>