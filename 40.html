<!doctype html><html lang=zh-cn><title>DNS 标志位简要解析 - imlonghao</title><meta name=description content="根据规范，一个 DNS 包可以分为下面的几个部分"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=renderer content="webkit"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><link rel=dns-prefetch href=//vip1.loli.net><link rel=stylesheet href=/static/hw3x7x.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqusjs.css integrity="sha256-GxdCIOyfxQ1OBfS99qAIJDoGK1ADuBsxhMTqXG82fAY=" crossorigin=anonymous><script src=/static/hw3x7x.js async></script><script src=https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqus.js integrity="sha256-LVaMHPQ2zLqOc5rXSAfr4d1PIkEGNLyyUTDNPZmTtUw=" crossorigin=anonymous></script><script src=//instant.page/3.0.0 type=module defer integrity=sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1></script><link rel=alternate type=application/rss+xml title="imlonghao Feed" href=https://imlonghao.com/feed.xml><div id=container><div id=header><div id=post-nav><a href=./>Home</a>
&nbsp;»&nbsp;
<a href=./40.html>DNS 标志位简要解析</a></div></div><div class=clearfix></div><div id=title>DNS 标志位简要解析</div><div id=content class=markdown-body><h2>概述</h2><p>根据规范，一个 DNS 包可以分为下面的几个部分。<p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/VKewfclW8qmSvIM.jpg><p>其中，身份 ID 占 16 个位，标志符占 16 个位，下面的分别是请求数、回答数、权威域名服务器数、其他记录数，再下面一点的就是回答的内容了（请求、回答、权威域名服务器、其他记录）<p>可以对照下面这个 Wireshark 抓到的针对本站 <code>imlonghao.com</code> 的一次 DNS 请求进行理解<p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/AUBQaFm4Kr5wPfj.jpg><p>本博文主要讲述的是 DNS 包中的几个标志位<h2>标志位</h2><p>正如上面所提供的 Wireshark 的截图，我们可以看到一个名为 <code>Flags</code> 的栏目，这个就是我们今天要讲的标志位。<p>标志位总长 16 个位，也就是两个字符。<p>有相应值的位标记为 1 ，没有的则标记为 0 。<p>最后这 16 个二进制的位通过进制转换即可变成十六进制的，在图中也就是 <code>81 80</code><h3>QR <small>1bit</small></h3><ul><li><code>0</code> 为客户端请求包<li><code>1</code> 为服务器响应包</ul><h3>Opcode <small>4bits</small></h3><ul><li><code>0000</code> 为普通的 DNS 请求<li><code>0001</code> 为 rDNS 请求<li><code>0002</code> 为服务器状态<li><code>0003</code> 无<li><code>0004</code> 为通知 (Notify)<li><code>0005</code> 为更新 (Update)<li><code>0006 - 0015</code> 保留</ul><h3>AA <small>1bit</small></h3><ul><li><code>0</code> 为应答服务器不是该域名的权威解析服务器<li><code>1</code> 为应答服务器是该域名的权威解析服务器</ul><h3>TC <small>1bit</small></h3><ul><li><code>0</code> 为报文未截断<li><code>1</code> 为报文过长被截断 (只返回了前 512 个字节)</ul><h3>RD <small>1bit</small></h3><ul><li><code>0</code> 为不期望进行递归查询<li><code>1</code> 为期望进行递归查询 (从域名服务器进行递归查询)</ul><h3>RA <small>1bit</small></h3><ul><li><code>0</code> 为应答服务器不支持递归查询<li><code>1</code> 为应答服务器支持递归查询</ul><h3>Z <small>1bit</small></h3><p>保留位<h3>AD <small>1bit</small></h3><ul><li><code>0</code> 为应答服务器未验证了该查询相关的 DNSSEC 数字签名<li><code>1</code> 为应答服务器已经验证了该查询相关的 DNSSEC 数字签名</ul><h3>CD <small>1bit</small></h3><ul><li><code>0</code> 为服务器已经进行了相关 DNSSEC 数字签名的验证<li><code>1</code> 为服务器并未进行相关 DNSSEC 数字签名的验证</ul><h3>Rcode <small>4bits</small></h3><ul><li><code>0000</code> 为正常<li><code>0001</code> 为格式错误 (NS 无法解析这个请求)<li><code>0002</code> 为服务器错误 (NS 有问题所以无法进行这个请求)<li><code>0003</code> 为名称错误 (请求中的地址并不存在)<li><code>0004</code> 为未实施查询 (NS 服务器不支持这种查询)<li><code>0005</code> 为拒绝 (由于策略原因拒绝执行这个错误)<li><code>0006</code> 为域名出现了但是他不该出现<li><code>0007</code> 为集合 RR 存在但是他不该存在<li><code>0008</code> 为集合 RR 不存在但是他应该存在<li><code>0009</code> 为服务器并不是这个区域的权威服务器<li><code>0010</code> 为该名称并不包含在区域中<li><code>0011 - 0015</code> 保留<li><code>0016</code> 为错误的 OPT 版本或者 TSIG 签名无效<li><code>0017</code> 为无法识别的密钥<li><code>0018</code> 为签名不在时间范围内<li><code>0019</code> 为错误的 TKEY 模式<li><code>0020</code> 为重复的密钥名称<li><code>0021</code> 为该算法不支持<li><code>0022</code> 为错误的截断<li><code>0023 - 3840</code> 保留<li><code>3841 - 4095</code> 私人使用<li><code>4096 - 65534</code> 保留<li><code>65535</code> RFC 6195</ul><h2>参考资料</h2><p><a href=http://www.networksorcery.com/enp/protocol/dns.htm rel=nofollow>DNS, Domain Name System - networksorcery.com</a><p><a href="http://netsec.ccert.edu.cn/duanhx/?p=1479" rel=nofollow>DNSSEC 原理、配置与布署简介 | 段海新( Haixin Duan ) @ Tsinghua University</a></div></div><div id=disqus_thread></div><div id=footer><span>Copyright © 2015 - 2020 imlonghao. Theme by
<a href=http://simiki.org/ target=_blank rel="noopener noreferrer">Simiki</a>. CC BY-NC-SA 4.0</span></div><script src=https://cdn.jsdelivr.net/npm/cfga@1.0.3/cfga.min.js integrity="sha256-TXHTTKAPRQ9mgacgN+couk0xnzQ6uOXTZ5ojH1q6GUk=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/vanilla-lazyload@12.3.0/dist/lazyload.min.js integrity="sha256-bojBIKfs4l2WDcJODncBIGEe5fhU7/sM3zRO5/f2nqE=" crossorigin=anonymous async></script>