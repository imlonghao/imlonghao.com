<!doctype html><html lang=zh-cn><title>Python 支付宝免签工具发布 - imlonghao</title><meta name=description content="这是一个比较简陋的工具，起码，暂时来说，比较简陋，但是功能确实实在的。"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=renderer content="webkit"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><link rel=dns-prefetch href=//vip1.loli.net><link rel=stylesheet href=/static/hw3x7x.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqusjs.css integrity="sha256-GxdCIOyfxQ1OBfS99qAIJDoGK1ADuBsxhMTqXG82fAY=" crossorigin=anonymous><script src=/static/hw3x7x.js async></script><script src=https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqus.js integrity="sha256-LVaMHPQ2zLqOc5rXSAfr4d1PIkEGNLyyUTDNPZmTtUw=" crossorigin=anonymous></script><script src=//instant.page/3.0.0 type=module defer integrity=sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1></script><link rel=alternate type=application/rss+xml title="imlonghao Feed" href=https://imlonghao.com/feed.xml><div id=container><div id=header><div id=post-nav><a href=./>Home</a>
&nbsp;»&nbsp;
<a href=./24.html>Python 支付宝免签工具发布</a></div></div><div class=clearfix></div><div id=title>Python 支付宝免签工具发布</div><div id=content class=markdown-body><p>这是一个比较简陋的工具，起码，暂时来说，比较简陋，但是功能确实实在的。<h2>写在最前</h2><p>虽然很少上 Hostloc ，但是我对于现在各位所玩的各种玩意也是比较熟悉的。<p>我在论坛看到很多关于支付宝免签的工具，不负责任的说，其中的绝大多数都是由易语言等等来进行开发的，因此这些程序的运行环境都是需要 Windows 的服务器或者其他 Windows 的挂机宝，这也给各位站长带来了极大的不变，不过这也催生了 2 欧之类廉价独立服务器的市场（因为可以装 Windows）。<p>现在各位站长基本上都是人手一台 VPS 的了，Python 几乎是每台机子的必备，那么何不写一个 Python 版的支付宝免签工具呢？<p>于是，本品诞生了。<h2>一点小坑</h2><p>在分析支付宝交易记录的时候，我就感受到了深深的恶意。<p><img class=lazy data-src=https://vip1.loli.net/2019/12/26/u2lfSPMQVoyiAB7.jpg><p>也许看图片没有什么感觉，我就文字表达一下，支付宝在几乎每个文字的最前面，都加上了好多好多的制表符以及换行符，这最终导致了我需要用到 <code>i.string[13:-8]</code> 类似这样坑爹的形式来提取信息。幸运的是，他们的数量都是一样的，因此这个问题也很快就弄好了。<p>其他，也没觉得什么坑，关于 <code>bs4</code> ，RTFM 就好了。<h2>使用教程</h2><p><strong>由于我只写了一个支付宝交易记录的监控提示工具，因此与站点进行对接的 API 或者说是插件就需要你们自己去写了。</strong><p>如果仅仅是想进行测试的，可以使用 <a href=https://requestb.in/ rel=nofollow>RequestBin</a><p>下面我将带领你们进行使用配置<h3>获取代码</h3><p>我的代码均存放在 Github 上，项目地址：<a href=https://github.com/imlonghao/python-alipay-tool rel=nofollow>https://github.com/imlonghao/python-alipay-tool</a><p>因此可能需要你下载你的服务器环境中安装 <code>git</code> ，如果没有，可以执行下面的语句进行安装。<pre><code>apt-get install git  (Debian/Ubuntu)
yum install git  (CentOS)
</code></pre><p><code>git</code> 安装好后我们就可以获取代码了。<pre><code>git clone https://github.com/imlonghao/python-alipay-tool.git
</code></pre><h3>配置环境</h3><p>程序使用到了几个非自带的库，因此需要我们通过 pip 进行安装。 pip 的安装如下（仅提供 Debian / Ubuntu ，CentOS 用户自行琢磨）<pre><code>apt-get install python-pip
</code></pre><p>然后我们进入目录开始配置环境<pre><code>cd python-alipay-tool
pip install -r requirements.txt
</code></pre><p>如果不出意外的话，环境现在就已经是配置好了。<p>当然，如果有问题的话，你们可以回帖进行咨询，可能需要一个 Disqus 的帐号。<h3>获取 ALIPAYJSESSIONID</h3><p>经过我的研究，只需要一个 <code>ALIPAYJSESSIONID</code> 就可以获取到账户的交易记录。<p>打开我们自己的浏览器，打开支付宝的官方网站，输入自己的帐号并且成功登录，这时候我们就有了一个 <code>ALIPAYJSESSIONID</code> 的值在我们的 Cookies 中了。<p>按 F12 进入开发人员工具（或者叫审查元素），选择 <code>Resource</code> ，然后选择 <code>Cookies</code> ，然后选择域名。<p>一般来说 <code>ALIPAYJSESSIONID</code> 会在第一个，双击 <code>ALIPAYJSESSIONID</code> 的值，然后 <code>Ctrl+C</code> 进行复制。<p>在这里例子中，<code>12ez034551231236p7111231232Z00R</code> 就是我们的 <code>ALIPAYJSESSIONID</code> 了。<h3>配置程序</h3><p>进入主目录后，我们可以清楚的看到 <code>alipay.py</code> 就是我们的主程序，你可以使用 <code>vim</code> 或者 <code>nano</code> 来进行编辑，这全取决与你的喜爱。<pre><code>vim alipay.py
</code></pre><p>将我们在上面获取到的 <code>ALIPAYJSESSIONID</code> 填写在后面的引号中，接着设置好我们的 API 通信地址，用来和你的服务器进行交互，然后设置好 KEY ，当然你也可以不设置，只要你确保你的 API 的安全的别人不知道的。<p>设置好后，7-10 行大概就是这样的。<pre><code>cookies = {'ALIPAYJSESSIONID': '12ez03455440s2ZwjS76p7112v05GEaUOuth12Z00R'}
url = 'https://lab.alipay.com/consume/record/items.htm'
api = 'https://imlonghao.com/api/v1'
key = '215v9b42yv7y97v1'
</code></pre><p>然后按 <code>:wq</code> 保存<h3>运行程序</h3><p>相信这一步不需要多说了，我相信你们由很多种方式可以运行起来的。<h2>程序说明</h2><h3>生成订单</h3><p>订单的生成和大多数现成的一样，都是采用支付宝的生活支付里面的转款到支付宝，可以采用如下表单或者类似的东西。<pre><code>&lt;form action='https://shenghuo.alipay.com/send/payment/fill.htm' method='post' accept-charset='gb2312' onsubmit=&quot;document.charset='gb2312'&quot;&gt;
&lt;input name='optEmail' type='hidden' value='[收款人 Email]'&gt;
&lt;input name='payAmount' type='hidden' value='[金额]'&gt;
&lt;input name='title' type='hidden' value='[订单号]'&gt;
&lt;input name='memo' type='hidden' value='请勿修改付款说明，付款后系统自动到账'&gt;
&lt;/form&gt;
</code></pre><h3>结果回调</h3><p>结果的回调会使用 POST 的方式向 API 地址发出信息，默认以 KEY 来核对身份。<p>向 API 发送的内容参考 <code>alipay.py</code> 中 44-48 行的内容<p><code>key</code> ：为用户设置的密钥<p><code>ddh</code> ：为支付宝生成的订单号<p><code>time</code> ： 为交易时间，整数时间戳<p><code>name</code> ：如果用户不改变的话即为您的程序所生成的订单号，在生活支付中为支付说明<p><code>money</code> ：金额，请在 API 中核对支付的金额何所需要支付的金额是否正确<p>以上 5 个项目的名字均是可以改变的，您只需要修改一下程序中的相关参数即可！<h2>写在最后</h2><p>我相信我的这个工具还是由很多的不足的，首先欢迎各位在 Github 上给我提交 PR。<p>如果各位围观群众有比较好的，关于程序上面的需求的话，例如掉线通知什么的，欢迎在 <a href=https://github.com/imlonghao/python-alipay-tool/issues rel=nofollow>issues</a> 上给我提交，我会优先处理 <a href=https://github.com/imlonghao/python-alipay-tool/issues rel=nofollow>issues</a> 上面的东西。<p>另外需要注意的是，<code>ALIPAYJSESSIONID</code> 的有效期并不长，因此请尽快复制到程序上并且运行程序。</div></div><div id=disqus_thread></div><div id=footer><span>Copyright © 2015 - 2020 imlonghao. Theme by
<a href=http://simiki.org/ target=_blank rel="noopener noreferrer">Simiki</a>. CC BY-NC-SA 4.0</span></div><script src=https://cdn.jsdelivr.net/npm/cfga@1.0.3/cfga.min.js integrity="sha256-TXHTTKAPRQ9mgacgN+couk0xnzQ6uOXTZ5ojH1q6GUk=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/vanilla-lazyload@12.3.0/dist/lazyload.min.js integrity="sha256-bojBIKfs4l2WDcJODncBIGEe5fhU7/sM3zRO5/f2nqE=" crossorigin=anonymous async></script>